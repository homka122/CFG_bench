name: Build

on:
    push:
        branches: ["*"]
    pull_request:
        branches: [main]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2

            - name: Install depends
              run: |
                  sudo apt-get update
                  sudo apt-get install -y gcc make git ccache

            - name: Build and install graphblas
              run: |
                  git clone https://github.com/DrTimothyAldenDavis/GraphBLAS.git
                  cd GraphBLAS
                  make compact
                  sudo make install
                  cd ..

            - name: Build and install LAGraph v1.2
              run: |
                  git clone https://github.com/GraphBLAS/LAGraph.git
                  cd LAGraph
                  git checkout v1.2
                  make
                  sudo make install
                  cd ..

            - name: Launch benchmark
              run: |
                  export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
                  make bench
